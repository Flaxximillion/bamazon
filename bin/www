#!/usr/bin/env node

let app = require('../app');
let debug = require('debug')('bamazon:server');

let server = require('http').Server(app);
let io = require('socket.io')(server);

const {Pool, Client} = require('pg');
const connectionString = process.env.DATABASE_URL;

const pool = new Pool({
    connectionString: connectionString
});

const query = {
    text: 'CREATE TABLE users (' +
    'id SERIAL PRIMARY KEY,' +
    'item_name VARCHAR(50) NOT NULL,' +
    'item_price INT NOT NULL);'
};

io.on('connection', function(socket){
    socket.on('user', function(){
        pool.query('select * from users', (err, res)=>{
            if(err){
                console.log(err.stack);
            } else {
                console.log(res.rows[0]);
            }
        })
    })
});

function sendQuery(query){
    pool.query(query, (err, res)=>{
        if(err){
            console.log(err.stack)
        } else {
            console.log('yar', res.rows[0]);
        }
    })
}

server.listen(process.env.PORT || 3000);